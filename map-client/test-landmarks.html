<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üö≤ Bike Taxi - Landmark Test</title>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyB6-shv9yZ-TePQmbXUTiewlRUIe2Y-AAo&libraries=places&callback=initMap" async defer></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background: #f8f9fa;
        }
        
        .test-container {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        .test-title {
            color: #333;
            font-size: 1.5rem;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
        }
        
        .test-section h3 {
            color: #007bff;
            margin-bottom: 15px;
        }
        
        .test-button {
            background: #007bff;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            margin: 5px;
            font-size: 0.9rem;
            transition: all 0.3s;
        }
        
        .test-button:hover {
            background: #0056b3;
            transform: translateY(-1px);
        }
        
        .test-button.success {
            background: #28a745;
        }
        
        .test-button.success:hover {
            background: #218838;
        }
        
        .test-button.warning {
            background: #ffc107;
            color: #212529;
        }
        
        .test-button.warning:hover {
            background: #e0a800;
        }
        
        .status {
            padding: 10px;
            border-radius: 6px;
            margin: 10px 0;
            font-weight: 500;
        }
        
        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .status.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        
        .log {
            background: #f8f9fa;
            border: 1px solid #e1e5e9;
            border-radius: 6px;
            padding: 15px;
            font-family: monospace;
            font-size: 0.9rem;
            max-height: 200px;
            overflow-y: auto;
            margin-top: 15px;
        }
        
        .map-container {
            height: 400px;
            border-radius: 8px;
            overflow: hidden;
            margin: 20px 0;
            border: 2px solid #e1e5e9;
        }
        
        .location-info {
            background: #e9ecef;
            padding: 15px;
            border-radius: 6px;
            margin: 10px 0;
        }
        
        .location-info h4 {
            margin: 0 0 10px 0;
            color: #495057;
        }
        
        .location-info p {
            margin: 5px 0;
            font-family: monospace;
        }
        
        .navigation-links {
            text-align: center;
            margin-top: 30px;
        }
        
        .navigation-links a {
            display: inline-block;
            background: #000;
            color: white;
            text-decoration: none;
            padding: 12px 24px;
            border-radius: 6px;
            margin: 0 10px;
            transition: background 0.3s;
        }
        
        .navigation-links a:hover {
            background: #333;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1 class="test-title">üö≤ Bike Taxi - Landmark & Location Test</h1>
        
        <div class="test-section">
            <h3>üìç Location Permission Test</h3>
            <p>Test location permission and get your current location with landmark names:</p>
            <button class="test-button" onclick="testLocationPermission()">Request Location Permission</button>
            <button class="test-button success" onclick="testCurrentLocation()">Get Current Location</button>
            <button class="test-button warning" onclick="clearLocationData()">Clear Location Data</button>
            <div id="locationStatus" class="status"></div>
            <div id="locationInfo" class="location-info" style="display: none;">
                <h4>üìç Your Current Location:</h4>
                <p id="currentCoords">Coordinates: Not available</p>
                <p id="currentLandmark">Landmark: Not available</p>
                <p id="currentAddress">Address: Not available</p>
            </div>
        </div>
        
        <div class="test-section">
            <h3>üó∫Ô∏è Map & Landmark Test</h3>
            <p>Test the map functionality and landmark detection:</p>
            <div id="map" class="map-container"></div>
            <button class="test-button" onclick="testMapClick()">Test Map Click</button>
            <button class="test-button" onclick="testReverseGeocoding()">Test Reverse Geocoding</button>
            <button class="test-button" onclick="testNearbyPlaces()">Test Nearby Places</button>
            <div id="mapStatus" class="status"></div>
        </div>
        
        <div class="test-section">
            <h3>üîç Landmark Detection Test</h3>
            <p>Test landmark detection for specific coordinates:</p>
            <input type="text" id="testLat" placeholder="Latitude" style="padding: 8px; margin: 5px; border: 1px solid #ccc; border-radius: 4px; width: 150px;">
            <input type="text" id="testLng" placeholder="Longitude" style="padding: 8px; margin: 5px; border: 1px solid #ccc; border-radius: 4px; width: 150px;">
            <button class="test-button" onclick="testSpecificLocation()">Test Specific Location</button>
            <div id="landmarkStatus" class="status"></div>
        </div>
        
        <div class="test-section">
            <h3>üìä Test Log</h3>
            <div id="testLog" class="log">Test log will appear here...</div>
            <button class="test-button" onclick="clearLog()">Clear Log</button>
        </div>
        
        <div class="navigation-links">
            <a href="index.html">üö≤ Go to Main App</a>
            <a href="test-stability.html">üîß Stability Test</a>
        </div>
    </div>

    <script>
        let map;
        let geocoder;
        let placesService;
        let nearbyPlacesService;
        let userLocation = null;
        let logEntries = [];
        
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const entry = `[${timestamp}] ${message}`;
            logEntries.push(entry);
            
            const logElement = document.getElementById('testLog');
            logElement.textContent = logEntries.join('\n');
            logElement.scrollTop = logElement.scrollHeight;
            
            console.log(`[${type.toUpperCase()}] ${message}`);
        }
        
        function clearLog() {
            logEntries = [];
            document.getElementById('testLog').textContent = 'Test log cleared...';
        }
        
        function showStatus(elementId, message, type = 'info') {
            const element = document.getElementById(elementId);
            element.textContent = message;
            element.className = `status ${type}`;
        }
        
        function initMap() {
            log('Initializing map...');
            
            const defaultLocation = { lat: 20.5937, lng: 78.9629 }; // India center
            
            map = new google.maps.Map(document.getElementById('map'), {
                zoom: 10,
                center: defaultLocation,
                mapTypeId: google.maps.MapTypeId.ROADMAP
            });
            
            geocoder = new google.maps.Geocoder();
            placesService = new google.maps.places.PlacesService(map);
            nearbyPlacesService = new google.maps.places.PlacesService(map);
            
            log('Map and services initialized successfully');
            showStatus('mapStatus', '‚úÖ Map initialized successfully', 'success');
            
            // Add map click listener
            map.addListener('click', function(event) {
                log(`Map clicked at: ${event.latLng.lat()}, ${event.latLng.lng()}`);
                testReverseGeocodingForLocation(event.latLng);
            });
        }
        
        function testLocationPermission() {
            log('Testing location permission...');
            
            if (!navigator.geolocation) {
                showStatus('locationStatus', '‚ùå Geolocation not supported', 'error');
                log('Geolocation not supported by browser', 'error');
                return;
            }
            
            navigator.geolocation.getCurrentPosition(
                function(position) {
                    userLocation = {
                        lat: position.coords.latitude,
                        lng: position.coords.longitude,
                        accuracy: position.coords.accuracy
                    };
                    
                    log(`Location permission granted: ${userLocation.lat}, ${userLocation.lng}`);
                    showStatus('locationStatus', '‚úÖ Location permission granted', 'success');
                    
                    // Center map on user location
                    const userLatLng = new google.maps.LatLng(userLocation.lat, userLocation.lng);
                    map.setCenter(userLatLng);
                    map.setZoom(15);
                    
                    // Add marker
                    new google.maps.Marker({
                        position: userLatLng,
                        map: map,
                        title: 'Your Location',
                        icon: {
                            url: 'data:image/svg+xml;charset=UTF-8,' + encodeURIComponent(`
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <circle cx="12" cy="12" r="10" fill="#4285F4" stroke="white" stroke-width="2"/>
                                    <circle cx="12" cy="12" r="4" fill="white"/>
                                </svg>
                            `),
                            scaledSize: new google.maps.Size(24, 24),
                            anchor: new google.maps.Point(12, 12)
                        }
                    });
                    
                },
                function(error) {
                    log(`Location permission denied: ${error.message}`, 'error');
                    showStatus('locationStatus', `‚ùå Location permission denied: ${error.message}`, 'error');
                },
                {
                    enableHighAccuracy: true,
                    timeout: 10000,
                    maximumAge: 60000
                }
            );
        }
        
        function testCurrentLocation() {
            if (!userLocation) {
                showStatus('locationStatus', '‚ùå No location data. Request permission first.', 'error');
                return;
            }
            
            log('Testing current location landmark detection...');
            
            const position = new google.maps.LatLng(userLocation.lat, userLocation.lng);
            
            // Update location info display
            document.getElementById('currentCoords').textContent = 
                `Coordinates: ${userLocation.lat.toFixed(6)}, ${userLocation.lng.toFixed(6)}`;
            
            // Get landmark name
            geocoder.geocode({ location: position }, function(results, status) {
                if (status === 'OK' && results[0]) {
                    const result = results[0];
                    const landmarkName = extractLandmarkName(result);
                    
                    document.getElementById('currentLandmark').textContent = `Landmark: ${landmarkName}`;
                    document.getElementById('currentAddress').textContent = `Address: ${result.formatted_address}`;
                    document.getElementById('locationInfo').style.display = 'block';
                    
                    log(`Current location landmark: ${landmarkName}`);
                    showStatus('locationStatus', `‚úÖ Landmark detected: ${landmarkName}`, 'success');
                    
                } else {
                    document.getElementById('currentLandmark').textContent = 'Landmark: Not found';
                    document.getElementById('currentAddress').textContent = 'Address: Not found';
                    document.getElementById('locationInfo').style.display = 'block';
                    
                    log('Landmark detection failed', 'error');
                    showStatus('locationStatus', '‚ùå Landmark detection failed', 'error');
                }
            });
        }
        
        function clearLocationData() {
            userLocation = null;
            document.getElementById('locationInfo').style.display = 'none';
            showStatus('locationStatus', '‚úÖ Location data cleared', 'success');
            log('Location data cleared');
        }
        
        function testMapClick() {
            log('Map click test - click anywhere on the map above');
            showStatus('mapStatus', '‚ÑπÔ∏è Click anywhere on the map to test landmark detection', 'info');
        }
        
        function testReverseGeocoding() {
            if (!userLocation) {
                showStatus('mapStatus', '‚ùå No location data. Get location first.', 'error');
                return;
            }
            
            log('Testing reverse geocoding...');
            const position = new google.maps.LatLng(userLocation.lat, userLocation.lng);
            testReverseGeocodingForLocation(position);
        }
        
        function testReverseGeocodingForLocation(position) {
            geocoder.geocode({ location: position }, function(results, status) {
                if (status === 'OK' && results[0]) {
                    const result = results[0];
                    const landmarkName = extractLandmarkName(result);
                    
                    log(`Reverse geocoding successful: ${landmarkName}`);
                    showStatus('mapStatus', `‚úÖ Landmark: ${landmarkName}`, 'success');
                    
                    // Add marker with landmark name
                    new google.maps.Marker({
                        position: position,
                        map: map,
                        title: landmarkName
                    });
                    
                } else {
                    log(`Reverse geocoding failed: ${status}`, 'error');
                    showStatus('mapStatus', `‚ùå Reverse geocoding failed: ${status}`, 'error');
                }
            });
        }
        
        function testNearbyPlaces() {
            if (!userLocation) {
                showStatus('mapStatus', '‚ùå No location data. Get location first.', 'error');
                return;
            }
            
            log('Testing nearby places search...');
            const position = new google.maps.LatLng(userLocation.lat, userLocation.lng);
            
            const request = {
                location: position,
                radius: 100,
                type: ['establishment', 'point_of_interest']
            };
            
            nearbyPlacesService.nearbySearch(request, function(results, status) {
                if (status === google.maps.places.PlacesServiceStatus.OK && results.length > 0) {
                    log(`Found ${results.length} nearby places`);
                    showStatus('mapStatus', `‚úÖ Found ${results.length} nearby places`, 'success');
                    
                    // Show first 3 places
                    results.slice(0, 3).forEach((place, index) => {
                        log(`Nearby place ${index + 1}: ${place.name}`);
                    });
                    
                } else {
                    log('No nearby places found', 'error');
                    showStatus('mapStatus', '‚ùå No nearby places found', 'error');
                }
            });
        }
        
        function testSpecificLocation() {
            const lat = parseFloat(document.getElementById('testLat').value);
            const lng = parseFloat(document.getElementById('testLng').value);
            
            if (isNaN(lat) || isNaN(lng)) {
                showStatus('landmarkStatus', '‚ùå Please enter valid coordinates', 'error');
                return;
            }
            
            log(`Testing specific location: ${lat}, ${lng}`);
            const position = new google.maps.LatLng(lat, lng);
            
            // Center map on location
            map.setCenter(position);
            map.setZoom(15);
            
            // Test reverse geocoding
            geocoder.geocode({ location: position }, function(results, status) {
                if (status === 'OK' && results[0]) {
                    const result = results[0];
                    const landmarkName = extractLandmarkName(result);
                    
                    log(`Landmark for ${lat}, ${lng}: ${landmarkName}`);
                    showStatus('landmarkStatus', `‚úÖ Landmark: ${landmarkName}`, 'success');
                    
                    // Add marker
                    new google.maps.Marker({
                        position: position,
                        map: map,
                        title: landmarkName
                    });
                    
                } else {
                    log(`Landmark detection failed for ${lat}, ${lng}: ${status}`, 'error');
                    showStatus('landmarkStatus', `‚ùå Landmark detection failed: ${status}`, 'error');
                }
            });
        }
        
        function extractLandmarkName(result) {
            let landmarkName = '';
            
            // Try to find the most relevant landmark name
            for (let component of result.address_components) {
                if (component.types.includes('establishment') || 
                    component.types.includes('point_of_interest') ||
                    component.types.includes('premise')) {
                    landmarkName = component.long_name;
                    break;
                }
            }
            
            // If no landmark found, use street address
            if (!landmarkName) {
                const streetNumber = result.address_components.find(c => c.types.includes('street_number'));
                const route = result.address_components.find(c => c.types.includes('route'));
                const locality = result.address_components.find(c => c.types.includes('locality'));
                
                if (streetNumber && route) {
                    landmarkName = `${streetNumber.long_name} ${route.long_name}`;
                } else if (route) {
                    landmarkName = route.long_name;
                } else if (locality) {
                    landmarkName = locality.long_name;
                }
            }
            
            // If still no name, use formatted address
            if (!landmarkName) {
                landmarkName = result.formatted_address;
            }
            
            return landmarkName;
        }
        
        // Initialize test page
        document.addEventListener('DOMContentLoaded', function() {
            log('Landmark test page loaded');
            log('Ready to test location and landmark functionality...');
        });
    </script>
</body>
</html> 